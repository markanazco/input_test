<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Touch Input Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        input, select, button, textarea {
            padding: 10px;
            font-size: 16px;
            margin: 10px;
            display: block;
            width: 100%;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        #textInput {
            font-size: 16px;
            display: none; /* El campo de texto no es accesible hasta iniciar */
        }
    </style>
</head>
<body>
    <h1>Touch Input Test</h1>

    <form id="userForm">
        <label for="age">Edad (solo 2 dígitos):</label>
        <input type="number" id="age" name="age" placeholder="Ingrese su edad" min="10" max="99" required>

        <label for="sex">Sexo:</label>
        <select id="sex" name="sex" required>
            <option value="masculino">Masculino</option>
            <option value="femenino">Femenino</option>
            <option value="otro">Otro</option>
            <option value="prefiero_no_decirlo">Prefiero no decirlo</option>
        </select>

        <label for="textInput">Ingrese los datos que se le indicarán:</label>
        <textarea id="textInput" name="textInput" placeholder="Ingrese el texto aquí" required></textarea>

        <button type="button" id="actionButton">Iniciar</button>
    </form>

    <script>
        let actionButton = document.getElementById("actionButton");
        let textInputField = document.getElementById("textInput");
        let userForm = document.getElementById("userForm");

        // Deshabilitar el campo de texto hasta que se presione "Iniciar"
        textInputField.disabled = true;

        actionButton.addEventListener("click", function() {
            if (actionButton.textContent === "Iniciar") {
                // Verificar si la edad y el sexo son válidos antes de iniciar
                let age = document.getElementById("age").value;
                let sex = document.getElementById("sex").value;

                if (!age || !sex) {
                    alert("Por favor, ingrese todos los datos (edad y sexo).");
                    return;
                }

                if (age < 10 || age > 99) {
                    alert("La edad debe ser entre 10 y 99 años.");
                    return;
                }

                // Iniciar el proceso
                textInputField.style.display = "block"; // Mostrar el campo de texto
                textInputField.disabled = false; // Habilitar el campo de texto
                textInputField.focus(); // Foco en el campo de texto
                actionButton.textContent = "Finalizar"; // Cambiar el texto del botón a "Finalizar"
            } else {
                // Detener el proceso y enviar los datos
                let age = document.getElementById("age").value;
                let sex = document.getElementById("sex").value;
                let textInput = document.getElementById("textInput").value;

                // Validar que el texto haya sido ingresado
                if (textInput.length === 0) {
                    alert("Por favor ingrese el texto.");
                    return;
                }

                // Deshabilitar el botón mientras se envían los datos
                actionButton.disabled = true;

                // Aquí se pueden enviar los datos a Google Sheets
                fetch("https://script.google.com/macros/s/AKfycbxbY_Dc2ed96JJbTeCn0w5LWy9OeizIH_m7x74JHFFoBLfIczNzoVCwkgUFaZVkBrtayw/exec", {
                    method: "POST",
                    body: JSON.stringify({
                        edad: age,
                        sexo: sex,
                        inputDato: textInput,
                        tiempoTotal: "0" // Puedes agregar el tiempo si lo tienes
                    }),
                    headers: {
                        "Content-Type": "application/json"
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Respuesta del servidor no es OK: " + response.status);
                    }
                    return response.text();
                })
                .then(data => {
                    alert("Datos enviados correctamente");
                    actionButton.disabled = false;
                    resetForm();
                })
                .catch(error => {
                    alert("Error al enviar los datos: " + error.message);
                    actionButton.disabled = false;
                    console.error(error); // Ver más detalles en la consola del navegador
                });
            }
        });

        function resetForm() {
            // Restablecer la interfaz para el próximo intento
            actionButton.textContent = "Iniciar"; // Volver a mostrar el botón "Iniciar"
            textInputField.style.display = "none"; // Ocultar el campo de texto
            textInputField.disabled = true; // Deshabilitar el campo de texto hasta el siguiente intento
            document.getElementById("age").value = "";
            document.getElementById("sex").value = "masculino";
            document.getElementById("textInput").value = "";
        }

        // Limitar la entrada de la edad a 2 dígitos
        document.getElementById("age").addEventListener("input", function() {
            let age = document.getElementById("age").value;
            if (age.length > 2) {
                document.getElementById("age").value = age.slice(0, 2);
            }
        });
    </script>
</body>
</html>
